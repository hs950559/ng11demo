(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{UyQ7:function(t,e,s){"use strict";s.r(e),s.d(e,"CommentsModule",function(){return ps});var i=s("ofXK"),n=s("tyNb"),r=s("fXoL"),a=s("pLZG"),c=s("lJxs"),o=s("D0XW"),h=s("mlxB"),d=s("7o/Q"),l=s("WMd4");function u(t,e=o.a){const s=Object(h.a)(t)?+t-e.now():Math.abs(t);return t=>t.lift(new y(s,e))}class y{constructor(t,e){this.delay=t,this.scheduler=e}call(t,e){return e.subscribe(new p(t,this.delay,this.scheduler))}}class p extends d.a{constructor(t,e,s){super(t),this.delay=e,this.scheduler=s,this.queue=[],this.active=!1,this.errored=!1}static dispatch(t){const e=t.source,s=e.queue,i=t.scheduler,n=t.destination;for(;s.length>0&&s[0].time-i.now()<=0;)s.shift().notification.observe(n);if(s.length>0){const e=Math.max(0,s[0].time-i.now());this.schedule(t,e)}else this.unsubscribe(),e.active=!1}_schedule(t){this.active=!0,this.destination.add(t.schedule(p.dispatch,this.delay,{source:this,destination:this.destination,scheduler:t}))}scheduleNotification(t){if(!0===this.errored)return;const e=this.scheduler,s=new g(e.now()+this.delay,t);this.queue.push(s),!1===this.active&&this._schedule(e)}_next(t){this.scheduleNotification(l.a.createNext(t))}_error(t){this.errored=!0,this.queue=[],this.destination.error(t),this.unsubscribe()}_complete(){this.scheduleNotification(l.a.createComplete()),this.unsubscribe()}}class g{constructor(t,e){this.time=t,this.notification=e}}var b=s("tS1D"),m=s("JIr8"),f=s("jtHE");function O(t,e,s){let i;return i=t&&"object"==typeof t?t:{bufferSize:t,windowTime:e,refCount:!1,scheduler:s},t=>t.lift(function({bufferSize:t=Number.POSITIVE_INFINITY,windowTime:e=Number.POSITIVE_INFINITY,refCount:s,scheduler:i}){let n,r,a=0,c=!1,o=!1;return function(h){let d;a++,!n||c?(c=!1,n=new f.a(t,e,i),d=n.subscribe(this),r=h.subscribe({next(t){n.next(t)},error(t){c=!0,n.error(t)},complete(){o=!0,r=void 0,n.complete()}})):d=n.subscribe(this),this.add(()=>{a--,d.unsubscribe(),r&&!o&&s&&0===a&&(r.unsubscribe(),r=void 0,n=void 0)})}}(i))}var v=s("IzEk"),S=s("5+tZ"),E=s("zp1y"),C=s("bOdf"),j=s("tk/3"),M=s("z6cu"),A=s("LRne"),w=s("DH7j"),D=s("yCtX"),k=s("l7GE"),x=s("ZUHj");function R(...t){if(1===t.length){if(!Object(w.a)(t[0]))return t[0];t=t[0]}return Object(D.a)(t,void 0).lift(new N)}class N{call(t,e){return e.subscribe(new I(t))}}class I extends k.a{constructor(t){super(t),this.hasFirst=!1,this.observables=[],this.subscriptions=[]}_next(t){this.observables.push(t)}_complete(){const t=this.observables,e=t.length;if(0===e)this.destination.complete();else{for(let s=0;s<e&&!this.hasFirst;s++){const e=t[s],i=Object(x.a)(this,e,void 0,s);this.subscriptions&&this.subscriptions.push(i),this.add(i)}this.observables=null}}notifyNext(t,e,s){if(!this.hasFirst){this.hasFirst=!0;for(let t=0;t<this.subscriptions.length;t++)if(t!==s){let e=this.subscriptions[t];e.unsubscribe(),this.remove(e)}this.subscriptions=null}this.destination.next(e)}}var U=s("VRyK"),$=s("l7P3");const T={EntitiesOnly:0,Both:1,None:2};function F(t){return function(e,s){const i={ids:[...s.ids],entities:Object.assign({},s.entities)},n=t(e,i);return n===T.Both?Object.assign({},s,i):n===T.EntitiesOnly?Object.assign(Object.assign({},s),{entities:i.entities}):s}}function L(t,e){const s=e(t);return Object(r.U)()&&void 0===s&&console.warn("@ngrx/entity: The entity passed to the `selectId` implementation returned undefined.","You should probably provide your own `selectId` implementation.","The entity that was passed:",t,"The `selectId` implementation:",e.toString()),s}function B(t){function e(e,s){const i=L(e,t);return i in s.entities?T.None:(s.ids.push(i),s.entities[i]=e,T.Both)}function s(t,s){let i=!1;for(const n of t)i=e(n,s)!==T.None||i;return i?T.Both:T.None}function i(t,e){return e.ids=[],e.entities={},s(t,e),T.Both}function n(t,e){const s=(t instanceof Array?t:e.ids.filter(s=>t(e.entities[s]))).filter(t=>t in e.entities).map(t=>delete e.entities[t]).length>0;return s&&(e.ids=e.ids.filter(t=>t in e.entities)),s?T.Both:T.None}function r(t,e){return a([t],e)}function a(e,s){const i={};return(e=e.filter(t=>t.id in s.entities)).length>0?e.filter(e=>function(e,s,i){const n=Object.assign({},i.entities[s.id],s.changes),r=L(n,t),a=r!==s.id;return a&&(e[s.id]=r,delete i.entities[s.id]),i.entities[r]=n,a}(i,e,s)).length>0?(s.ids=s.ids.map(t=>i[t]||t),T.Both):T.EntitiesOnly:T.None}function c(e,i){const n=[],r=[];for(const s of e){const e=L(s,t);e in i.entities?r.push({id:e,changes:s}):n.push(s)}const c=a(r,i),o=s(n,i);switch(!0){case o===T.None&&c===T.None:return T.None;case o===T.Both||c===T.Both:return T.Both;default:return T.EntitiesOnly}}return{removeAll:function(t){return Object.assign({},t,{ids:[],entities:{}})},addOne:F(e),addMany:F(s),addAll:F(i),setAll:F(i),setOne:F(function(e,s){const i=L(e,t);return i in s.entities?(s.entities[i]=e,T.EntitiesOnly):(s.ids.push(i),s.entities[i]=e,T.Both)}),updateOne:F(r),updateMany:F(a),upsertOne:F(function(t,e){return c([t],e)}),upsertMany:F(c),removeOne:F(function(t,e){return n([t],e)}),removeMany:F(n),map:F(function(t,e){return a(e.ids.reduce((s,i)=>{const n=t(e.entities[i]);return n!==e.entities[i]&&s.push({id:i,changes:n}),s},[]).filter(({id:t})=>t in e.entities),e)}),mapOne:F(function({map:t,id:e},s){const i=s.entities[e];return i?r({id:e,changes:t(i)},s):T.None})}}T[T.EntitiesOnly]="EntitiesOnly",T[T.Both]="Both",T[T.None]="None";var q=s("9jGm");let K=(()=>{class t{create(t,e,s,i){const n="string"==typeof t?Object.assign(Object.assign({},i||{}),{entityName:t,entityOp:e,data:s}):t;return this.createCore(n)}createCore(t){const{entityName:e,entityOp:s,tag:i}=t;if(!e)throw new Error("Missing entity name for new action");if(null==s)throw new Error("Missing EntityOp for new action");return{type:this.formatActionType(s,i||e),payload:t}}createFromAction(t,e){return this.create(Object.assign(Object.assign({},t.payload),e))}formatActionType(t,e){return`[${e}] ${t}`}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=r.Eb({token:t,factory:t.\u0275fac}),t})();class P{constructor(t,e){this.entityName=t,this.selectId=e}mustBeEntity(t){const e=this.extractData(t);if(!e)return this.throwError(t,"should have a single entity.");const s=this.selectId(e);return this.isNotKeyType(s)&&this.throwError(t,"has a missing or invalid entity key (id)"),e}mustBeEntities(t){const e=this.extractData(t);return Array.isArray(e)?(e.forEach((e,s)=>{const i=this.selectId(e);this.isNotKeyType(i)&&this.throwError(t,`, item ${s+1}, does not have a valid entity key (id)`)}),e):this.throwError(t,"should be an array of entities")}mustBeKey(t){const e=this.extractData(t);if(!e)throw new Error("should be a single entity key");if(this.isNotKeyType(e))throw new Error("is not a valid key (id)");return e}mustBeKeys(t){const e=this.extractData(t);return Array.isArray(e)?(e.forEach((e,s)=>{this.isNotKeyType(e)&&this.throwError(t,`${this.entityName} ', item ${s+1}, is not a valid entity key (id)`)}),e):this.throwError(t,"should be an array of entity keys (id)")}mustBeUpdate(t){const e=this.extractData(t);if(!e)return this.throwError(t,"should be a single entity update");const{id:s,changes:i}=e,n=this.selectId(i);return(this.isNotKeyType(s)||this.isNotKeyType(n))&&this.throwError(t,"has a missing or invalid entity key (id)"),e}mustBeUpdates(t){const e=this.extractData(t);return Array.isArray(e)?(e.forEach((e,s)=>{const{id:i,changes:n}=e,r=this.selectId(n);(this.isNotKeyType(i)||this.isNotKeyType(r))&&this.throwError(t,`, item ${s+1}, has a missing or invalid entity key (id)`)}),e):this.throwError(t,"should be an array of entity updates")}mustBeUpdateResponse(t){const e=this.extractData(t);if(!e)return this.throwError(t,"should be a single entity update");const{id:s,changes:i}=e,n=this.selectId(i);return(this.isNotKeyType(s)||this.isNotKeyType(n))&&this.throwError(t,"has a missing or invalid entity key (id)"),e}mustBeUpdateResponses(t){const e=this.extractData(t);return Array.isArray(e)?(e.forEach((e,s)=>{const{id:i,changes:n}=e,r=this.selectId(n);(this.isNotKeyType(i)||this.isNotKeyType(r))&&this.throwError(t,`, item ${s+1}, has a missing or invalid entity key (id)`)}),e):this.throwError(t,"should be an array of entity updates")}extractData(t){return t.payload&&t.payload.data}isNotKeyType(t){return"string"!=typeof t&&"number"!=typeof t}throwError(t,e){throw new Error(`${this.entityName} EntityAction guard for "${t.type}": payload ${e}`)}}function V(t){return null==t?void 0:t.id}function G(t){if(null==t)return[];if(Array.isArray(t[0])){const[e,...s]=t;t=[...e,...s]}return t}function Q(t){return t=t||V,function(e){const s=t(e);if(null==s)throw new Error("Primary key may not be null/undefined.");return e&&{id:s,changes:e}}}function _(...t){const e=G(t);switch(e.length){case 0:return Object(a.a)(t=>t.payload&&null!=t.payload.entityOp);case 1:const t=e[0];return Object(a.a)(e=>e.payload&&t===e.payload.entityOp);default:return Object(a.a)(t=>{const s=t.payload&&t.payload.entityOp;return s&&e.some(t=>t===s)})}}function W(...t){const e=G(t);switch(e.length){case 0:return Object(a.a)(t=>t.payload&&null!=t.payload.entityName);case 1:const t=e[0];return Object(a.a)(e=>e.payload&&t===e.payload.entityName);default:return Object(a.a)(t=>{const s=t.payload&&t.payload.entityName;return!!s&&e.some(t=>t===s)})}}const H="Add",J="Delete",z="Update",Z="Upsert";function X(t){const e=(t=t&&t.changes?t:{changes:[]}).changes.filter(t=>null!=t&&t.entities&&t.entities.length>0);return Object.assign(Object.assign({},t),{changes:e})}new class{add(t,e){return e=Array.isArray(e)?e:e?[e]:[],{entityName:t,op:H,entities:e}}delete(t,e){const s=Array.isArray(e)?e:e?[e]:[];return{entityName:t,op:J,entities:s}}update(t,e){return e=Array.isArray(e)?e:e?[e]:[],{entityName:t,op:z,entities:e}}upsert(t,e){return e=Array.isArray(e)?e:e?[e]:[],{entityName:t,op:Z,entities:e}}};const Y={IgnoreChanges:0,PreserveChanges:1,OverwriteChanges:2};Y[Y.IgnoreChanges]="IgnoreChanges",Y[Y.PreserveChanges]="PreserveChanges",Y[Y.OverwriteChanges]="OverwriteChanges";const tt="@ngrx/data/entity-cache/clear-collections",et="@ngrx/data/entity-cache/load-collections",st="@ngrx/data/entity-cache/merge-query-set",it="@ngrx/data/entity-cache/set-cache",nt="@ngrx/data/entity-cache/save-entities",rt="@ngrx/data/entity-cache/save-entities-cancel",at="@ngrx/data/entity-cache/save-entities-error",ct="@ngrx/data/entity-cache/save-entities-success";class ot{constructor(t,e){this.type=tt,this.payload={collections:t,tag:e}}}class ht{constructor(t,e){this.type=et,this.payload={collections:t,tag:e}}}class dt{constructor(t,e,s){this.type=st,this.payload={querySet:t,mergeStrategy:null===e?Y.PreserveChanges:e,tag:s}}}class lt{constructor(t,e){this.cache=t,this.type=it,this.payload={cache:t,tag:e}}}class ut{constructor(t,e,s){this.type=nt,s=s||{},t&&(t.tag=t.tag||s.tag),this.payload=Object.assign(Object.assign({changeSet:t,url:e},s),{tag:t.tag})}}class yt{constructor(t,e,s,i){this.type=rt,this.payload={correlationId:t,reason:e,entityNames:s,tag:i}}}class pt{constructor(t,e,s){this.type=rt,this.payload={correlationId:t,reason:e,tag:s}}}class gt{constructor(t,e){this.type=at,this.payload={error:t,originalAction:e,correlationId:e.payload.correlationId}}}class bt{constructor(t,e,s){this.type=ct,s=s||{},t&&(t.tag=t.tag||s.tag),this.payload=Object.assign(Object.assign({changeSet:t,url:e},s),{tag:t.tag})}}const mt="@ngrx/data/cancel-persist",ft="@ngrx/data/query-all",Ot="@ngrx/data/query-load",vt="@ngrx/data/query-many",St="@ngrx/data/query-by-key",Et="@ngrx/data/save/add-many",Ct="@ngrx/data/save/add-many/success",jt="@ngrx/data/save/add-one",Mt="@ngrx/data/save/delete-many",At="@ngrx/data/save/delete-many/success",wt="@ngrx/data/save/delete-one",Dt="@ngrx/data/save/update-many",kt="@ngrx/data/save/update-many/success",xt="@ngrx/data/save/update-one",Rt="@ngrx/data/save/upsert-many",Nt="@ngrx/data/save/upsert-many/success",It="@ngrx/data/save/upsert-one",Ut="@ngrx/data/add-all",$t="@ngrx/data/add-many",Tt="@ngrx/data/add-one",Ft="@ngrx/data/remove-all",Lt="@ngrx/data/remove-many",Bt="@ngrx/data/remove-one",qt="@ngrx/data/update-many",Kt="@ngrx/data/update-one",Pt="@ngrx/data/upsert-many",Vt="@ngrx/data/upsert-one",Gt="@ngrx/data/set-filter",Qt="@ngrx/data/set-loaded",_t="@ngrx/data/set-loading",Wt="/success",Ht="/error";function Jt(t){return t+Wt}class zt{constructor(t,e){this.error=t,this.requestData=e,this.message="string"==typeof t?t:function(t){const{error:e,body:s,message:i}=t;let n=null;return e?n="string"==typeof e?e:e.message:i?n=i:s&&(n="string"==typeof s?s:s.error),"string"==typeof n?n:n?JSON.stringify(n):null}(t)}}class Zt{}class Xt{}const Yt=new r.q("@ngrx/data/plural-names");class te{}class ee{}let se=(()=>{class t{constructor(t){this.pluralizer=t,this.knownHttpResourceUrls={}}getResourceUrls(t,e){let s=this.knownHttpResourceUrls[t];if(!s){const i=function(t){return t.replace(/^[\/\s]+|[\/\s]+$/g,"")}(e);s={entityResourceUrl:`${i}/${t}/`.toLowerCase(),collectionResourceUrl:`${i}/${this.pluralizer.pluralize(t)}/`.toLowerCase()},this.registerHttpResourceUrls({[t]:s})}return s}entityResource(t,e){return this.getResourceUrls(t,e).entityResourceUrl}collectionResource(t,e){return this.getResourceUrls(t,e).collectionResourceUrl}registerHttpResourceUrls(t){this.knownHttpResourceUrls=Object.assign(Object.assign({},this.knownHttpResourceUrls),t||{})}}return t.\u0275fac=function(e){return new(e||t)(r.Rb(te))},t.\u0275prov=r.Eb({token:t,factory:t.\u0275fac}),t})();class ie{constructor(t,e,s,i){this.http=e,this.httpUrlGenerator=s,this.getDelay=0,this.saveDelay=0,this.timeout=0,this._name=t+" DefaultDataService",this.entityName=t;const{root:n="api",delete404OK:r=!0,getDelay:a=0,saveDelay:c=0,timeout:o=0}=i||{};this.delete404OK=r,this.entityUrl=s.entityResource(t,n),this.entitiesUrl=s.collectionResource(t,n),this.getDelay=a,this.saveDelay=c,this.timeout=o}get name(){return this._name}add(t){const e=t||new Error(`No "${this.entityName}" entity to add`);return this.execute("POST",this.entityUrl,e)}delete(t){let e;return null==t&&(e=new Error(`No "${this.entityName}" key to delete`)),this.execute("DELETE",this.entityUrl+t,e).pipe(Object(c.a)(e=>t))}getAll(){return this.execute("GET",this.entitiesUrl)}getById(t){let e;return null==t&&(e=new Error(`No "${this.entityName}" key to get`)),this.execute("GET",this.entityUrl+t,e)}getWithQuery(t){const e=new j.c("string"==typeof t?{fromString:t}:{fromObject:t});return this.execute("GET",this.entitiesUrl,void 0,{params:e})}update(t){const e=t&&t.id,s=null==e?new Error(`No "${this.entityName}" update data or id`):t.changes;return this.execute("PUT",this.entityUrl+e,s)}upsert(t){const e=t||new Error(`No "${this.entityName}" entity to upsert`);return this.execute("POST",this.entityUrl,e)}execute(t,e,s,i){const n={method:t,url:e,data:s,options:i};if(s instanceof Error)return this.handleError(n)(s);let r;switch(t){case"DELETE":r=this.http.delete(e,i),this.saveDelay&&(r=r.pipe(u(this.saveDelay)));break;case"GET":r=this.http.get(e,i),this.getDelay&&(r=r.pipe(u(this.getDelay)));break;case"POST":r=this.http.post(e,s,i),this.saveDelay&&(r=r.pipe(u(this.saveDelay)));break;case"PUT":r=this.http.put(e,s,i),this.saveDelay&&(r=r.pipe(u(this.saveDelay)));break;default:{const e=new Error("Unimplemented HTTP method, "+t);r=Object(M.a)(e)}}return this.timeout&&(r=r.pipe(Object(b.a)(this.timeout+this.saveDelay))),r.pipe(Object(m.a)(this.handleError(n)))}handleError(t){return e=>{const s=this.handleDelete404(e,t);if(s)return s;const i=new zt(e,t);return Object(M.a)(i)}}handleDelete404(t,e){if(404===t.status&&"DELETE"===e.method&&this.delete404OK)return Object(A.a)({})}}let ne=(()=>{class t{constructor(t,e,s){this.http=t,this.httpUrlGenerator=e,this.config=s,e.registerHttpResourceUrls((s=s||{}).entityHttpResourceUrls)}create(t){return new ie(t,this.http,this.httpUrlGenerator,this.config)}}return t.\u0275fac=function(e){return new(e||t)(r.Rb(j.a),r.Rb(ee),r.Rb(Zt,8))},t.\u0275prov=r.Eb({token:t,factory:t.\u0275fac}),t})();const re=new r.q("@ngrx/data/entity-metadata");let ae=(()=>{class t{constructor(t){this.definitions={},t&&t.forEach(t=>this.registerMetadataMap(t))}getDefinition(t,e=!0){t=t.trim();const s=this.definitions[t];if(!s&&e)throw new Error(`No EntityDefinition for entity type "${t}".`);return s}registerMetadata(t){if(t){const e=function(t){let e=t.entityName;if(!e)throw new Error("Missing required entityName");t.entityName=e=e.trim();const s=t.selectId||V,i=t.sortComparer=t.sortComparer||!1,n=function(t={}){const{selectId:e,sortComparer:s}=Object.assign({sortComparer:!1,selectId:t=>t.id},t),i={getInitialState:function(t={}){return Object.assign({ids:[],entities:{}},t)}},n={getSelectors:function(t){const e=t=>t.ids,s=t=>t.entities,i=Object($.s)(e,s,(t,e)=>t.map(t=>e[t])),n=Object($.s)(e,t=>t.length);return t?{selectIds:Object($.s)(t,e),selectEntities:Object($.s)(t,s),selectAll:Object($.s)(t,i),selectTotal:Object($.s)(t,n)}:{selectIds:e,selectEntities:s,selectAll:i,selectTotal:n}}},r=s?function(t,e){const{removeOne:s,removeMany:i,removeAll:n}=B(t);function r(t,e){return a([t],e)}function a(e,s){const i=e.filter(e=>!(L(e,t)in s.entities));return 0===i.length?T.None:(l(i,s),T.Both)}function c(t,e){return e.entities={},e.ids=[],a(t,e),T.Both}function o(t,e){return h([t],e)}function h(e,s){const i=[],n=e.filter(e=>function(e,s,i){if(!(s.id in i.entities))return!1;const n=Object.assign({},i.entities[s.id],s.changes),r=L(n,t);return delete i.entities[s.id],e.push(n),r!==s.id}(i,e,s)).length>0;if(0===i.length)return T.None;{const t=s.ids,e=[];return s.ids=s.ids.filter((t,i)=>t in s.entities||(e.push(i),!1)),l(i,s),!n&&e.every(e=>s.ids[e]===t[e])?T.EntitiesOnly:T.Both}}function d(e,s){const i=[],n=[];for(const a of e){const e=L(a,t);e in s.entities?n.push({id:e,changes:a}):i.push(a)}const r=h(n,s),c=a(i,s);switch(!0){case c===T.None&&r===T.None:return T.None;case c===T.Both||r===T.Both:return T.Both;default:return T.EntitiesOnly}}function l(s,i){s.sort(e);const n=[];let r=0,a=0;for(;r<s.length&&a<i.ids.length;){const c=s[r],o=L(c,t),h=i.ids[a];e(c,i.entities[h])<=0?(n.push(o),r++):(n.push(h),a++)}i.ids=n.concat(r<s.length?s.slice(r).map(t):i.ids.slice(a)),s.forEach((e,s)=>{i.entities[t(e)]=e})}return{removeOne:s,removeMany:i,removeAll:n,addOne:F(r),updateOne:F(o),upsertOne:F(function(t,e){return d([t],e)}),addAll:F(c),setAll:F(c),setOne:F(function(e,s){const i=L(e,t);return i in s.entities?(s.ids=s.ids.filter(t=>t!==i),l([e],s),T.Both):r(e,s)}),addMany:F(a),updateMany:F(h),upsertMany:F(d),map:F(function(t,e){return h(e.ids.reduce((s,i)=>{const n=t(e.entities[i]);return n!==e.entities[i]&&s.push({id:i,changes:n}),s},[]),e)}),mapOne:F(function({map:t,id:e},s){const i=s.entities[e];return i?o({id:e,changes:t(i)},s):T.None})}}(e,s):B(e);return Object.assign(Object.assign(Object.assign({selectId:e,sortComparer:s},i),n),r)}({selectId:s,sortComparer:i}),r=t.entityDispatcherOptions||{},a=n.getInitialState(Object.assign({entityName:e,filter:"",loaded:!1,loading:!1,changeState:{}},t.additionalCollectionState||{}));return{entityName:e,entityAdapter:n,entityDispatcherOptions:r,initialState:a,metadata:t,noChangeTracking:!0===t.noChangeTracking,selectId:s,sortComparer:i}}(t);this.registerDefinition(e)}}registerMetadataMap(t={}){Object.keys(t||{}).forEach(e=>this.registerMetadata(Object.assign({entityName:e},t[e])))}registerDefinition(t){this.definitions[t.entityName]=t}registerDefinitions(t){Object.assign(this.definitions,t)}}return t.\u0275fac=function(e){return new(e||t)(r.Rb(re,8))},t.\u0275prov=r.Eb({token:t,factory:t.\u0275fac}),t})();const ce=z;let oe=(()=>{class t{constructor(t,e,s){this.entityDefinitionService=t,this.http=e,this.idSelectors={},this.saveDelay=0,this.timeout=0;const{saveDelay:i=0,timeout:n=0}=s||{};this.saveDelay=i,this.timeout=n}saveEntities(t,e){t=this.filterChangeSet(t),t=this.flattenUpdates(t);let s=this.http.post(e,t).pipe(Object(c.a)(t=>this.restoreUpdates(t)),Object(m.a)(this.handleError({method:"POST",url:e,data:t})));return this.timeout&&(s=s.pipe(Object(b.a)(this.timeout))),this.saveDelay&&(s=s.pipe(u(this.saveDelay))),s}handleError(t){return e=>{const s=new zt(e,t);return Object(M.a)(s)}}filterChangeSet(t){return X(t)}flattenUpdates(t){let e=t.changes;if(0===e.length)return t;let s=!1;return e=e.map(t=>t.op===ce&&t.entities.length>0?(s=!0,Object.assign(Object.assign({},t),{entities:t.entities.map(t=>t.changes)})):t),s?Object.assign(Object.assign({},t),{changes:e}):t}restoreUpdates(t){if(null==t)return t;let e=t.changes;if(0===e.length)return t;let s=!1;return e=e.map(t=>{if(t.op===ce){s=!0;const e=this.getIdSelector(t.entityName);return Object.assign(Object.assign({},t),{entities:t.entities.map(t=>({id:e(t),changes:t}))})}return t}),s?Object.assign(Object.assign({},t),{changes:e}):t}getIdSelector(t){let e=this.idSelectors[t];return e||(e=this.entityDefinitionService.getDefinition(t).selectId,this.idSelectors[t]=e),e}}return t.\u0275fac=function(e){return new(e||t)(r.Rb(ae),r.Rb(j.a),r.Rb(Zt,8))},t.\u0275prov=r.Eb({token:t,factory:t.\u0275fac}),t})(),he=(()=>{class t{constructor(t){this.defaultDataServiceFactory=t,this.services={}}getService(t){t=t.trim();let e=this.services[t];return e||(e=this.defaultDataServiceFactory.create(t),this.services[t]=e),e}registerService(t,e){this.services[t.trim()]=e}registerServices(t){this.services=Object.assign(Object.assign({},this.services),t)}}return t.\u0275fac=function(e){return new(e||t)(r.Rb(ne))},t.\u0275prov=r.Eb({token:t,factory:t.\u0275fac}),t})();class de{}let le=(()=>{class t{constructor(t,e){this.logger=t,this.entityActionFactory=e}handleSuccess(t){const e=Jt(t.payload.entityOp);return s=>this.entityActionFactory.createFromAction(t,{entityOp:e,data:s})}handleError(t){const e=t.payload.entityOp+Ht;return s=>{const i={error:s instanceof zt?s:new zt(s,null),originalAction:t};return this.logger.error(i),this.entityActionFactory.createFromAction(t,{entityOp:e,data:i})}}}return t.\u0275fac=function(e){return new(e||t)(r.Rb(Xt),r.Rb(K))},t.\u0275prov=r.Eb({token:t,factory:t.\u0275fac}),t})(),ue=(()=>{class t{constructor(){this.seed=0,this.prefix="CRID"}next(){return this.seed+=1,this.prefix+this.seed}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=r.Eb({token:t,factory:t.\u0275fac}),t})(),ye=(()=>{class t{constructor(){this.optimisticAdd=!1,this.optimisticDelete=!0,this.optimisticUpdate=!1,this.optimisticUpsert=!1,this.optimisticSaveEntities=!1}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=r.Eb({token:t,factory:t.\u0275fac}),t})();class pe{constructor(t){this.message=t,this.message=t||"Canceled by user"}}let ge=(()=>{class t{constructor(t,e,s,i){this.correlationIdGenerator=t,this.defaultDispatcherOptions=e,this.store=i,this.reducedActions$=s.pipe(O(1)),this.raSubscription=this.reducedActions$.subscribe()}dispatch(t){return this.store.dispatch(t),t}cancelSaveEntities(t,e,s,i){if(!t)throw new Error("Missing correlationId");const n=new yt(t,e,s,i);this.dispatch(n)}clearCollections(t,e){this.dispatch(new ot(t,e))}loadCollections(t,e){this.dispatch(new ht(t,e))}mergeQuerySet(t,e,s){this.dispatch(new dt(t,e,s))}setEntityCache(t,e){this.dispatch(new lt(t,e))}saveEntities(t,e,s){const i=Array.isArray(t)?{changes:t}:t,n=null==(s=s||{}).correlationId?this.correlationIdGenerator.next():s.correlationId,r=null==s.isOptimistic?this.defaultDispatcherOptions.optimisticSaveEntities||!1:!0===s.isOptimistic,a=s.tag||"Save Entities";s=Object.assign(Object.assign({},s),{correlationId:n,isOptimistic:r,tag:a});const c=new ut(i,e,s);return this.dispatch(c),this.getSaveEntitiesResponseData$(s.correlationId).pipe(O(1))}getSaveEntitiesResponseData$(t){return this.reducedActions$.pipe(Object(a.a)(t=>t.type===ct||t.type===at||t.type===rt),Object(a.a)(e=>t===e.payload.correlationId),Object(v.a)(1),Object(S.a)(t=>t.type===rt?Object(M.a)(new pe(t.payload.reason)):t.type===ct?Object(A.a)(t.payload.changeSet):Object(M.a)(t.payload)))}}return t.\u0275fac=function(e){return new(e||t)(r.Rb(ue),r.Rb(ye),r.Rb($.g),r.Rb($.i))},t.\u0275prov=r.Eb({token:t,factory:t.\u0275fac}),t})();class be{constructor(t,e,s,i=V,n,r,a,c){this.entityName=t,this.entityActionFactory=e,this.store=s,this.selectId=i,this.defaultDispatcherOptions=n,this.reducedActions$=r,this.correlationIdGenerator=c,this.guard=new P(t,i),this.toUpdate=Q(i);const o=Object($.s)(a,e=>e[t]);this.entityCollection$=s.select(o)}createEntityAction(t,e,s){return this.entityActionFactory.create(Object.assign({entityName:this.entityName,entityOp:t,data:e},s))}createAndDispatch(t,e,s){const i=this.createEntityAction(t,e,s);return this.dispatch(i),i}dispatch(t){return this.store.dispatch(t),t}add(t,e){e=this.setSaveEntityActionOptions(e,this.defaultDispatcherOptions.optimisticAdd);const s=this.createEntityAction(jt,t,e);return e.isOptimistic&&this.guard.mustBeEntity(s),this.dispatch(s),this.getResponseData$(e.correlationId).pipe(Object(E.a)(this.entityCollection$),Object(c.a)(([t,e])=>e.entities[this.selectId(t)]),O(1))}cancel(t,e,s){if(!t)throw new Error("Missing correlationId");this.createAndDispatch(mt,e,{correlationId:t})}delete(t,e){e=this.setSaveEntityActionOptions(e,this.defaultDispatcherOptions.optimisticDelete);const s=this.getKey(t),i=this.createEntityAction(wt,s,e);return this.guard.mustBeKey(i),this.dispatch(i),this.getResponseData$(e.correlationId).pipe(Object(c.a)(()=>s),O(1))}getAll(t){t=this.setQueryEntityActionOptions(t);const e=this.createEntityAction(ft,null,t);return this.dispatch(e),this.getResponseData$(t.correlationId).pipe(Object(E.a)(this.entityCollection$),Object(c.a)(([t,e])=>t.reduce((t,s)=>{const i=e.entities[this.selectId(s)];return i&&t.push(i),t},[])),O(1))}getByKey(t,e){e=this.setQueryEntityActionOptions(e);const s=this.createEntityAction(St,t,e);return this.dispatch(s),this.getResponseData$(e.correlationId).pipe(Object(E.a)(this.entityCollection$),Object(c.a)(([t,e])=>e.entities[this.selectId(t)]),O(1))}getWithQuery(t,e){e=this.setQueryEntityActionOptions(e);const s=this.createEntityAction(vt,t,e);return this.dispatch(s),this.getResponseData$(e.correlationId).pipe(Object(E.a)(this.entityCollection$),Object(c.a)(([t,e])=>t.reduce((t,s)=>{const i=e.entities[this.selectId(s)];return i&&t.push(i),t},[])),O(1))}load(t){t=this.setQueryEntityActionOptions(t);const e=this.createEntityAction(Ot,null,t);return this.dispatch(e),this.getResponseData$(t.correlationId).pipe(O(1))}update(t,e){const s=this.toUpdate(t);e=this.setSaveEntityActionOptions(e,this.defaultDispatcherOptions.optimisticUpdate);const i=this.createEntityAction(xt,s,e);return e.isOptimistic&&this.guard.mustBeUpdate(i),this.dispatch(i),this.getResponseData$(e.correlationId).pipe(Object(c.a)(t=>t.changes),Object(E.a)(this.entityCollection$),Object(c.a)(([t,e])=>e.entities[this.selectId(t)]),O(1))}upsert(t,e){e=this.setSaveEntityActionOptions(e,this.defaultDispatcherOptions.optimisticUpsert);const s=this.createEntityAction(It,t,e);return e.isOptimistic&&this.guard.mustBeEntity(s),this.dispatch(s),this.getResponseData$(e.correlationId).pipe(Object(E.a)(this.entityCollection$),Object(c.a)(([t,e])=>e.entities[this.selectId(t)]),O(1))}addAllToCache(t,e){this.createAndDispatch(Ut,t,e)}addOneToCache(t,e){this.createAndDispatch(Tt,t,e)}addManyToCache(t,e){this.createAndDispatch($t,t,e)}clearCache(t){this.createAndDispatch(Ft,void 0,t)}removeOneFromCache(t,e){this.createAndDispatch(Bt,this.getKey(t),e)}removeManyFromCache(t,e){if(!t||0===t.length)return;const s="object"==typeof t[0]?t.map(t=>this.getKey(t)):t;this.createAndDispatch(Lt,s,e)}updateOneInCache(t,e){const s=this.toUpdate(t);this.createAndDispatch(Kt,s,e)}updateManyInCache(t,e){if(!t||0===t.length)return;const s=t.map(t=>this.toUpdate(t));this.createAndDispatch(qt,s,e)}upsertOneInCache(t,e){this.createAndDispatch(Vt,t,e)}upsertManyInCache(t,e){t&&0!==t.length&&this.createAndDispatch(Pt,t,e)}setFilter(t){this.createAndDispatch(Gt,t)}setLoaded(t){this.createAndDispatch(Qt,!!t)}setLoading(t){this.createAndDispatch(_t,!!t)}getKey(t){return"object"==typeof t?this.selectId(t):t}getResponseData$(t){return this.reducedActions$.pipe(Object(a.a)(t=>!!t.payload),Object(a.a)(e=>{const{correlationId:s,entityName:i,entityOp:n}=e.payload;return i===this.entityName&&s===t&&(n.endsWith(Wt)||n.endsWith(Ht)||n===mt)}),Object(v.a)(1),Object(S.a)(t=>{const{entityOp:e}=t.payload;return e===mt?Object(M.a)(new pe(t.payload.data)):e.endsWith(Wt)?Object(A.a)(t.payload.data):Object(M.a)(t.payload.data.error)}))}setQueryEntityActionOptions(t){const e=null==(t=t||{}).correlationId?this.correlationIdGenerator.next():t.correlationId;return Object.assign(Object.assign({},t),{correlationId:e})}setSaveEntityActionOptions(t,e){const s=null==(t=t||{}).correlationId?this.correlationIdGenerator.next():t.correlationId,i=null==t.isOptimistic?e||!1:!0===t.isOptimistic;return Object.assign(Object.assign({},t),{correlationId:s,isOptimistic:i})}}const me="entityCache",fe=new r.q("@ngrx/data/entity-cache-name"),Oe=new r.q("@ngrx/data/entity-cache-meta-reducers"),ve=new r.q("@ngrx/data/entity-collection-meta-reducers"),Se=new r.q("@ngrx/data/initial-entity-cache-state"),Ee=new r.q("@ngrx/data/entity-cache-selector"),Ce={provide:Ee,useFactory:je,deps:[[new r.A,fe]]};function je(t){return t=t||me,Object($.q)(t)}let Me=(()=>{class t{constructor(t,e,s,i,n,r){this.entityActionFactory=t,this.store=e,this.entityDispatcherDefaultOptions=s,this.entityCacheSelector=n,this.correlationIdGenerator=r,this.reducedActions$=i.pipe(O(1)),this.raSubscription=this.reducedActions$.subscribe()}create(t,e=V,s={}){const i=Object.assign(Object.assign({},this.entityDispatcherDefaultOptions),s);return new be(t,this.entityActionFactory,this.store,e,i,this.reducedActions$,this.entityCacheSelector,this.correlationIdGenerator)}ngOnDestroy(){this.raSubscription.unsubscribe()}}return t.\u0275fac=function(e){return new(e||t)(r.Rb(K),r.Rb($.i),r.Rb(ye),r.Rb($.g),r.Rb(Ee),r.Rb(ue))},t.\u0275prov=r.Eb({token:t,factory:t.\u0275fac}),t})();const Ae=new r.q("EntityEffects Scheduler");let we=(()=>{class t{constructor(t,e,s,i,n){this.actions=t,this.dataService=e,this.entityActionFactory=s,this.logger=i,this.scheduler=n,this.responseDelay=10,this.saveEntitiesCancel$=Object(q.d)(()=>this.actions.pipe(Object(q.e)(rt),Object(a.a)(t=>null!=t.payload.correlationId)),{dispatch:!1}),this.saveEntities$=Object(q.d)(()=>this.actions.pipe(Object(q.e)(nt),Object(S.a)(t=>this.saveEntities(t))))}saveEntities(t){const e=t.payload.error;if(e)return this.handleSaveEntitiesError$(t)(e);try{const e=X(t.payload.changeSet),{correlationId:s,mergeStrategy:i,tag:n,url:r}=t.payload,o={correlationId:s,mergeStrategy:i,tag:n};return 0===e.changes.length?Object(A.a)(new bt(e,r,o)):R(this.saveEntitiesCancel$.pipe(Object(a.a)(t=>s===t.payload.correlationId),Object(c.a)(t=>new pt(s,t.payload.reason,t.payload.tag))),this.dataService.saveEntities(e,r).pipe(Object(C.a)(e=>this.handleSaveEntitiesSuccess$(t,this.entityActionFactory)(e)),Object(m.a)(this.handleSaveEntitiesError$(t))))}catch(s){return this.handleSaveEntitiesError$(t)(s)}}handleSaveEntitiesError$(t){return e=>{const s=e instanceof zt?e:new zt(e,null);return Object(A.a)(new gt(s,t)).pipe(u(this.responseDelay,this.scheduler||o.b))}}handleSaveEntitiesSuccess$(t,e){const{url:s,correlationId:i,mergeStrategy:n,tag:r}=t.payload,a={correlationId:i,mergeStrategy:n,tag:r};return i=>{if(i)return Object(A.a)(new bt(i,s,a));if(i=t.payload.changeSet,!t.payload.isOptimistic)return Object(A.a)(new bt(i,s,a));const n=i.changes.reduce((t,e)=>-1===t.indexOf(e.entityName)?t.concat(e.entityName):t,[]);return Object(U.a)(n.map(t=>e.create(t,_t,!1)))}}}return t.\u0275fac=function(e){return new(e||t)(r.Rb(q.a),r.Rb(oe),r.Rb(K),r.Rb(Xt),r.Rb(Ae,8))},t.\u0275prov=r.Eb({token:t,factory:t.\u0275fac}),t})();const De=[ft,Ot,St,vt,jt,wt,xt,It];let ke=(()=>{class t{constructor(t,e,s,i,n){this.actions=t,this.dataService=e,this.entityActionFactory=s,this.resultHandler=i,this.scheduler=n,this.responseDelay=10,this.cancel$=Object(q.d)(()=>this.actions.pipe(_(mt),Object(c.a)(t=>t.payload.correlationId),Object(a.a)(t=>null!=t)),{dispatch:!1}),this.persist$=Object(q.d)(()=>this.actions.pipe(_(De),Object(S.a)(t=>this.persist(t))))}persist(t){if(t.payload.skip)return this.handleSkipSuccess$(t);if(t.payload.error)return this.handleError$(t)(t.payload.error);try{return R(this.cancel$.pipe(Object(a.a)(e=>t.payload.correlationId===e),Object(c.a)(e=>this.entityActionFactory.createFromAction(t,{entityOp:"@ngrx/data/canceled-persist"}))),this.callDataService(t).pipe(Object(c.a)(this.resultHandler.handleSuccess(t)),Object(m.a)(this.handleError$(t))))}catch(e){return this.handleError$(t)(e)}}callDataService(t){const{entityName:e,entityOp:s,data:i}=t.payload,n=this.dataService.getService(e);switch(s){case ft:case Ot:return n.getAll();case St:return n.getById(i);case vt:return n.getWithQuery(i);case jt:return n.add(i);case wt:return n.delete(i);case xt:const{id:t,changes:e}=i;return n.update(i).pipe(Object(c.a)(s=>s&&Object.keys(s).length>0?{id:t,changes:Object.assign(Object.assign({},e),s),changed:!0}:{id:t,changes:e,changed:!1}));case It:return n.upsert(i).pipe(Object(c.a)(t=>t&&Object.keys(t).length>0?t:i));default:throw new Error(`Persistence action "${s}" is not implemented.`)}}handleError$(t){return e=>Object(A.a)(this.resultHandler.handleError(t)(e)).pipe(u(this.responseDelay,this.scheduler||o.b))}handleSkipSuccess$(t){const e=Jt(t.payload.entityOp),s=this.entityActionFactory.createFromAction(t,{entityOp:e});return Object(A.a)(s).pipe(u(this.responseDelay,this.scheduler||o.b))}}return t.\u0275fac=function(e){return new(e||t)(r.Rb(q.a),r.Rb(he),r.Rb(K),r.Rb(de),r.Rb(Ae,8))},t.\u0275prov=r.Eb({token:t,factory:t.\u0275fac}),t})();class xe{constructor(t,e){this.entityName=t,t=t.trim();const{dispatcher:s,selectors:i,selectors$:n}=e.create(t);this.entityName=t,this.dispatcher=s,this.guard=s.guard,this.selectId=s.selectId,this.toUpdate=s.toUpdate,this.selectors=i,this.selectors$=n,this.collection$=n.collection$,this.count$=n.count$,this.entities$=n.entities$,this.entityActions$=n.entityActions$,this.entityMap$=n.entityMap$,this.errors$=n.errors$,this.filter$=n.filter$,this.filteredEntities$=n.filteredEntities$,this.keys$=n.keys$,this.loaded$=n.loaded$,this.loading$=n.loading$,this.changeState$=n.changeState$}createEntityAction(t,e,s){return this.dispatcher.createEntityAction(t,e,s)}createAndDispatch(t,e,s){return this.dispatcher.createAndDispatch(t,e,s)}dispatch(t){return this.dispatcher.dispatch(t)}get store(){return this.dispatcher.store}add(t,e){return this.dispatcher.add(t,e)}cancel(t,e,s){this.dispatcher.cancel(t,e,s)}delete(t,e){return this.dispatcher.delete(t,e)}getAll(t){return this.dispatcher.getAll(t)}getByKey(t,e){return this.dispatcher.getByKey(t,e)}getWithQuery(t,e){return this.dispatcher.getWithQuery(t,e)}load(t){return this.dispatcher.load(t)}update(t,e){return this.dispatcher.update(t,e)}upsert(t,e){return this.dispatcher.upsert(t,e)}addAllToCache(t,e){this.dispatcher.addAllToCache(t,e)}addOneToCache(t,e){this.dispatcher.addOneToCache(t,e)}addManyToCache(t,e){this.dispatcher.addManyToCache(t,e)}clearCache(){this.dispatcher.clearCache()}removeOneFromCache(t,e){this.dispatcher.removeOneFromCache(t,e)}removeManyFromCache(t,e){this.dispatcher.removeManyFromCache(t,e)}updateOneInCache(t,e){this.dispatcher.updateOneInCache(t,e)}updateManyInCache(t,e){this.dispatcher.updateManyInCache(t,e)}upsertOneInCache(t,e){this.dispatcher.upsertOneInCache(t,e)}upsertManyInCache(t,e){this.dispatcher.upsertManyInCache(t,e)}setFilter(t){this.dispatcher.setFilter(t)}setLoaded(t){this.dispatcher.setLoaded(!!t)}setLoading(t){this.dispatcher.setLoading(!!t)}}let Re=(()=>{class t{constructor(t){this.entityDefinitionService=t}create(t){const e=this.entityDefinitionService&&this.entityDefinitionService.getDefinition(t,!1);return e&&e.initialState||function(t){return{entityName:t,ids:[],entities:{},filter:void 0,loaded:!1,loading:!1,changeState:{}}}(t)}}return t.\u0275fac=function(e){return new(e||t)(r.Rb(ae,8))},t.\u0275prov=r.Eb({token:t,factory:t.\u0275fac}),t})(),Ne=(()=>{class t{constructor(t,e){this.entityCollectionCreator=t||new Re,this.selectEntityCache=e||je(me)}createCollectionSelector(t){return Object($.s)(this.selectEntityCache,(e={})=>e[t]||this.entityCollectionCreator.create(t))}createCollectionSelectors(t){const e="string"==typeof t?{entityName:t}:t,s=t=>t.ids,i=t=>t.entities,n=Object($.s)(s,i,(t,e)=>t.map(t=>e[t])),r=Object($.s)(s,t=>t.length),a=t=>t.filter,c=e.filterFn,o=c?Object($.s)(n,a,(t,e)=>c(t,e)):n,h={};return Object.keys(e.additionalCollectionState||{}).forEach(t=>{h["select"+t[0].toUpperCase()+t.slice(1)]=e=>e[t]}),Object.assign({selectCount:r,selectEntities:n,selectEntityMap:i,selectFilter:a,selectFilteredEntities:o,selectKeys:s,selectLoaded:t=>t.loaded,selectLoading:t=>t.loading,selectChangeState:t=>t.changeState},h)}create(t){const e="string"==typeof t?{entityName:t}:t,s=e.entityName,i=this.createCollectionSelector(s),n=this.createCollectionSelectors(e),r={};return Object.keys(n).forEach(t=>{r[t]=Object($.s)(i,n[t])}),Object.assign({entityName:s,selectCollection:i,selectEntityCache:this.selectEntityCache},r)}}return t.\u0275fac=function(e){return new(e||t)(r.Rb(Re,8),r.Rb(Ee,8))},t.\u0275prov=r.Eb({token:t,factory:t.\u0275fac}),t})(),Ie=(()=>{class t{constructor(t,e,s){this.store=t,this.actions=e,this.selectEntityCache=s,this.entityCache$=this.store.select(this.selectEntityCache),this.entityActionErrors$=e.pipe(Object(a.a)(t=>t.payload&&t.payload.entityOp&&t.payload.entityOp.endsWith(Ht)),O(1))}create(t,e){const s={entityName:t};return Object.keys(e).forEach(t=>{if(t.startsWith("select")){const i=t[6].toLowerCase()+t.substr(7)+"$";s[i]=this.store.select(e[t])}}),s.entityActions$=this.actions.pipe(W(t)),s.errors$=this.entityActionErrors$.pipe(W(t)),s}}return t.\u0275fac=function(e){return new(e||t)(r.Rb($.i),r.Rb(q.a),r.Rb(Ee))},t.\u0275prov=r.Eb({token:t,factory:t.\u0275fac}),t})(),Ue=(()=>{class t{constructor(t,e,s,i){this.entityDispatcherFactory=t,this.entityDefinitionService=e,this.entitySelectorsFactory=s,this.entitySelectors$Factory=i}create(t){t=t.trim();const e=this.entityDefinitionService.getDefinition(t),s=this.entityDispatcherFactory.create(t,e.selectId,e.entityDispatcherOptions),i=this.entitySelectorsFactory.create(e.metadata);return{dispatcher:s,entityName:t,selectors:i,selectors$:this.entitySelectors$Factory.create(t,i)}}}return t.\u0275fac=function(e){return new(e||t)(r.Rb(Me),r.Rb(ae),r.Rb(Ne),r.Rb(Ie))},t.\u0275prov=r.Eb({token:t,factory:t.\u0275fac}),t})(),$e=(()=>{class t{constructor(t){this.entityCollectionServiceElementsFactory=t}create(t){return new xe(t,this.entityCollectionServiceElementsFactory)}}return t.\u0275fac=function(e){return new(e||t)(r.Rb(Ue))},t.\u0275prov=r.Eb({token:t,factory:t.\u0275fac}),t})(),Te=(()=>{class t{constructor(t,e,s,i){this.entityCollectionServiceFactory=t,this.store=i,this.entityActionErrors$=s.entityActionErrors$,this.entityCache$=s.entityCache$,this.reducedActions$=e.reducedActions$}}return t.\u0275fac=function(e){return new(e||t)(r.Rb($e),r.Rb(Me),r.Rb(Ie),r.Rb($.i))},t.\u0275prov=r.Eb({token:t,factory:t.\u0275fac}),t})(),Fe=(()=>{class t{constructor(t){this.entityServicesElements=t,this.EntityCollectionServices={}}get entityActionErrors$(){return this.entityServicesElements.entityActionErrors$}get entityCache$(){return this.entityServicesElements.entityCache$}get entityCollectionServiceFactory(){return this.entityServicesElements.entityCollectionServiceFactory}get reducedActions$(){return this.entityServicesElements.reducedActions$}get store(){return this.entityServicesElements.store}dispatch(t){this.store.dispatch(t)}createEntityCollectionService(t){return this.entityCollectionServiceFactory.create(t)}getEntityCollectionService(t){let e=this.EntityCollectionServices[t];return e||(e=this.createEntityCollectionService(t),this.EntityCollectionServices[t]=e),e}registerEntityCollectionService(t,e){this.EntityCollectionServices[e||t.entityName]=t}registerEntityCollectionServices(t){Array.isArray(t)?t.forEach(t=>this.registerEntityCollectionService(t)):Object.keys(t||{}).forEach(e=>{this.registerEntityCollectionService(t[e],e)})}}return t.\u0275fac=function(e){return new(e||t)(r.Rb(Te))},t.\u0275prov=r.Eb({token:t,factory:t.\u0275fac}),t})();class Le{}const Be={Unchanged:0,Added:1,Deleted:2,Updated:3};Be[Be.Unchanged]="Unchanged",Be[Be.Added]="Added",Be[Be.Deleted]="Deleted",Be[Be.Updated]="Updated";class qe{constructor(t,e){this.adapter=t,this.selectId=e,this.selectId=e||V}commitAll(t){return 0===Object.keys(t.changeState).length?t:Object.assign(Object.assign({},t),{changeState:{}})}commitMany(t,e){if(null==t||0===t.length)return e;let s=!1;const i=t.reduce((t,e)=>{const i="object"==typeof e?this.selectId(e):e;return t[i]&&(s||(t=Object.assign({},t),s=!0),delete t[i]),t},e.changeState);return s?Object.assign(Object.assign({},e),{changeState:i}):e}commitOne(t,e){return null==t?e:this.commitMany([t],e)}mergeQueryResults(t,e,s){return this.mergeServerUpserts(t,e,Y.PreserveChanges,s)}mergeSaveAdds(t,e,s){return this.mergeServerUpserts(t,e,Y.OverwriteChanges,s)}mergeSaveDeletes(t,e,s){const i=t;return e=(s=null==s?Y.OverwriteChanges:s)===Y.IgnoreChanges?e:this.commitMany(i,e),this.adapter.removeMany(i,e)}mergeSaveUpdates(t,e,s,i=!1){if(null==t||0===t.length)return e;let n,r=!1,a=e.changeState;switch(s=null==s?Y.OverwriteChanges:s){case Y.IgnoreChanges:return n=c(t),this.adapter.updateMany(n,e);case Y.OverwriteChanges:return a=t.reduce((t,e)=>{const s=e.id;return t[s]&&(r||(t=Object.assign({},t),r=!0),delete t[s]),t},e.changeState),e=r?Object.assign(Object.assign({},e),{changeState:a}):e,n=c(t),this.adapter.updateMany(n,e);case Y.PreserveChanges:{const s=[];return a=t.reduce((t,e)=>{const i=e.id,n=t[i];if(n){r||(t=Object.assign({},t),r=!0);const s=this.selectId(e.changes),a=n;s!==i&&delete t[i];const c=Object.assign(Object.assign({},a.originalValue),e.changes);t[s]=Object.assign(Object.assign({},a),{originalValue:c})}else s.push(e);return t},e.changeState),e=r?Object.assign(Object.assign({},e),{changeState:a}):e,n=c(s),this.adapter.updateMany(n,e)}}function c(t){return!0===i&&(t=t.filter(t=>!0===t.changed)),t.map(t=>({id:t.id,changes:t.changes}))}}mergeSaveUpserts(t,e,s){return this.mergeServerUpserts(t,e,Y.OverwriteChanges,s)}mergeServerUpserts(t,e,s,i){if(null==t||0===t.length)return e;let n=!1,r=e.changeState;switch(i=null==i?s:i){case Y.IgnoreChanges:return this.adapter.upsertMany(t,e);case Y.OverwriteChanges:return e=this.adapter.upsertMany(t,e),r=t.reduce((t,e)=>{const s=this.selectId(e);return t[s]&&(n||(t=Object.assign({},t),n=!0),delete t[s]),t},e.changeState),n?Object.assign(Object.assign({},e),{changeState:r}):e;case Y.PreserveChanges:{const s=[];return r=t.reduce((t,e)=>{const i=this.selectId(e);return t[i]?n||(t=Object.assign(Object.assign({},t),{[i]:Object.assign(Object.assign({},t[i]),{originalValue:e})}),n=!0):s.push(e),t},e.changeState),e=this.adapter.upsertMany(s,e),n?Object.assign(Object.assign({},e),{changeState:r}):e}}}trackAddMany(t,e,s){if(s===Y.IgnoreChanges||null==t||0===t.length)return e;let i=!1;const n=t.reduce((t,s)=>{const n=this.selectId(s);if(null==n||""===n)throw new Error(e.entityName+" entity add requires a key to be tracked");return t[n]||(i||(i=!0,t=Object.assign({},t)),t[n]={changeType:Be.Added}),t},e.changeState);return i?Object.assign(Object.assign({},e),{changeState:n}):e}trackAddOne(t,e,s){return null==t?e:this.trackAddMany([t],e,s)}trackDeleteMany(t,e,s){if(s===Y.IgnoreChanges||null==t||0===t.length)return e;let i=!1;const n=e.entities,r=t.reduce((t,e)=>{const s=n[e];if(s){const i=t[e];i?i.changeType===Be.Added?(r(),delete t[e]):i.changeType===Be.Updated&&(r(),i.changeType=Be.Deleted):(r(),t[e]={changeType:Be.Deleted,originalValue:s})}return t;function r(){i||(i=!0,t=Object.assign({},t))}},e.changeState);return i?Object.assign(Object.assign({},e),{changeState:r}):e}trackDeleteOne(t,e,s){return null==t?e:this.trackDeleteMany([t],e,s)}trackUpdateMany(t,e,s){if(s===Y.IgnoreChanges||null==t||0===t.length)return e;let i=!1;const n=e.entities,r=t.reduce((t,s)=>{const{id:r}=s;if(null==r||""===r)throw new Error(e.entityName+" entity update requires a key to be tracked");const a=n[r];return a&&(t[r]||(i||(i=!0,t=Object.assign({},t)),t[r]={changeType:Be.Updated,originalValue:a})),t},e.changeState);return i?Object.assign(Object.assign({},e),{changeState:r}):e}trackUpdateOne(t,e,s){return null==t?e:this.trackUpdateMany([t],e,s)}trackUpsertMany(t,e,s){if(s===Y.IgnoreChanges||null==t||0===t.length)return e;let i=!1;const n=e.entities,r=t.reduce((t,s)=>{const r=this.selectId(s);if(null==r||""===r)throw new Error(e.entityName+" entity upsert requires a key to be tracked");if(!t[r]){i||(i=!0,t=Object.assign({},t));const e=n[r];t[r]=null==e?{changeType:Be.Added}:{changeType:Be.Updated,originalValue:e}}return t},e.changeState);return i?Object.assign(Object.assign({},e),{changeState:r}):e}trackUpsertOne(t,e,s){return null==t?e:this.trackUpsertMany([t],e,s)}undoAll(t){const e=Object.keys(t.changeState),{remove:s,upsert:i}=e.reduce((t,e)=>{const s=t.chgState[e];switch(s.changeType){case Be.Added:t.remove.push(e);break;case Be.Deleted:const i=s.originalValue;i&&t.upsert.push(i);break;case Be.Updated:t.upsert.push(s.originalValue)}return t},{remove:[],upsert:[],chgState:t.changeState});return t=this.adapter.removeMany(s,t),t=this.adapter.upsertMany(i,t),Object.assign(Object.assign({},t),{changeState:{}})}undoMany(t,e){if(null==t||0===t.length)return e;let s=!1;const{changeState:i,remove:n,upsert:r}=t.reduce((t,e)=>{let i=t.changeState;const n="object"==typeof e?this.selectId(e):e,r=i[n];if(r)switch(s||(i=Object.assign({},i),s=!0),delete i[n],t.changeState=i,r.changeType){case Be.Added:t.remove.push(n);break;case Be.Deleted:const e=r.originalValue;e&&t.upsert.push(e);break;case Be.Updated:t.upsert.push(r.originalValue)}return t},{remove:[],upsert:[],changeState:e.changeState});return e=this.adapter.removeMany(n,e),e=this.adapter.upsertMany(r,e),s?Object.assign(Object.assign({},e),{changeState:i}):e}undoOne(t,e){return null==t?e:this.undoMany([t],e)}}class Ke{constructor(t,e,s){this.entityName=t,this.definition=e,this.methods={[mt]:this.cancelPersist.bind(this),[ft]:this.queryAll.bind(this),"@ngrx/data/query-all/error":this.queryAllError.bind(this),"@ngrx/data/query-all/success":this.queryAllSuccess.bind(this),[St]:this.queryByKey.bind(this),"@ngrx/data/query-by-key/error":this.queryByKeyError.bind(this),"@ngrx/data/query-by-key/success":this.queryByKeySuccess.bind(this),[Ot]:this.queryLoad.bind(this),"@ngrx/data/query-load/error":this.queryLoadError.bind(this),"@ngrx/data/query-load/success":this.queryLoadSuccess.bind(this),[vt]:this.queryMany.bind(this),"@ngrx/data/query-many/error":this.queryManyError.bind(this),"@ngrx/data/query-many/success":this.queryManySuccess.bind(this),[Et]:this.saveAddMany.bind(this),"@ngrx/data/save/add-many/error":this.saveAddManyError.bind(this),[Ct]:this.saveAddManySuccess.bind(this),[jt]:this.saveAddOne.bind(this),"@ngrx/data/save/add-one/error":this.saveAddOneError.bind(this),"@ngrx/data/save/add-one/success":this.saveAddOneSuccess.bind(this),[Mt]:this.saveDeleteMany.bind(this),"@ngrx/data/save/delete-many/error":this.saveDeleteManyError.bind(this),[At]:this.saveDeleteManySuccess.bind(this),[wt]:this.saveDeleteOne.bind(this),"@ngrx/data/save/delete-one/error":this.saveDeleteOneError.bind(this),"@ngrx/data/save/delete-one/success":this.saveDeleteOneSuccess.bind(this),[Dt]:this.saveUpdateMany.bind(this),"@ngrx/data/save/update-many/error":this.saveUpdateManyError.bind(this),[kt]:this.saveUpdateManySuccess.bind(this),[xt]:this.saveUpdateOne.bind(this),"@ngrx/data/save/update-one/error":this.saveUpdateOneError.bind(this),"@ngrx/data/save/update-one/success":this.saveUpdateOneSuccess.bind(this),[Rt]:this.saveUpsertMany.bind(this),"@ngrx/data/save/upsert-many/error":this.saveUpsertManyError.bind(this),[Nt]:this.saveUpsertManySuccess.bind(this),[It]:this.saveUpsertOne.bind(this),"@ngrx/data/save/upsert-one/error":this.saveUpsertOneError.bind(this),"@ngrx/data/save/upsert-one/success":this.saveUpsertOneSuccess.bind(this),[Ut]:this.addAll.bind(this),[$t]:this.addMany.bind(this),[Tt]:this.addOne.bind(this),[Ft]:this.removeAll.bind(this),[Lt]:this.removeMany.bind(this),[Bt]:this.removeOne.bind(this),[qt]:this.updateMany.bind(this),[Kt]:this.updateOne.bind(this),[Pt]:this.upsertMany.bind(this),[Vt]:this.upsertOne.bind(this),"@ngrx/data/commit-all":this.commitAll.bind(this),"@ngrx/data/commit-many":this.commitMany.bind(this),"@ngrx/data/commit-one":this.commitOne.bind(this),"@ngrx/data/undo-all":this.undoAll.bind(this),"@ngrx/data/undo-many":this.undoMany.bind(this),"@ngrx/data/undo-one":this.undoOne.bind(this),"@ngrx/data/set-change-state":this.setChangeState.bind(this),"@ngrx/data/set-collection":this.setCollection.bind(this),[Gt]:this.setFilter.bind(this),[Qt]:this.setLoaded.bind(this),[_t]:this.setLoading.bind(this)},this.adapter=e.entityAdapter,this.isChangeTracking=!0!==e.noChangeTracking,this.selectId=e.selectId,this.guard=new P(t,this.selectId),this.toUpdate=Q(this.selectId),this.entityChangeTracker=s||new qe(this.adapter,this.selectId)}cancelPersist(t){return this.setLoadingFalse(t)}queryAll(t){return this.setLoadingTrue(t)}queryAllError(t,e){return this.setLoadingFalse(t)}queryAllSuccess(t,e){const s=this.extractData(e),i=this.extractMergeStrategy(e);return Object.assign(Object.assign({},this.entityChangeTracker.mergeQueryResults(s,t,i)),{loaded:!0,loading:!1})}queryByKey(t,e){return this.setLoadingTrue(t)}queryByKeyError(t,e){return this.setLoadingFalse(t)}queryByKeySuccess(t,e){const s=this.extractData(e),i=this.extractMergeStrategy(e);return t=null==s?t:this.entityChangeTracker.mergeQueryResults([s],t,i),this.setLoadingFalse(t)}queryLoad(t){return this.setLoadingTrue(t)}queryLoadError(t,e){return this.setLoadingFalse(t)}queryLoadSuccess(t,e){const s=this.extractData(e);return Object.assign(Object.assign({},this.adapter.addAll(s,t)),{loading:!1,loaded:!0,changeState:{}})}queryMany(t,e){return this.setLoadingTrue(t)}queryManyError(t,e){return this.setLoadingFalse(t)}queryManySuccess(t,e){const s=this.extractData(e),i=this.extractMergeStrategy(e);return Object.assign(Object.assign({},this.entityChangeTracker.mergeQueryResults(s,t,i)),{loading:!1})}saveAddMany(t,e){if(this.isOptimistic(e)){const s=this.guard.mustBeEntities(e),i=this.extractMergeStrategy(e);t=this.entityChangeTracker.trackAddMany(s,t,i),t=this.adapter.addMany(s,t)}return this.setLoadingTrue(t)}saveAddManyError(t,e){return this.setLoadingFalse(t)}saveAddManySuccess(t,e){const s=this.guard.mustBeEntities(e),i=this.extractMergeStrategy(e);return t=this.isOptimistic(e)?this.entityChangeTracker.mergeSaveUpserts(s,t,i):this.entityChangeTracker.mergeSaveAdds(s,t,i),this.setLoadingFalse(t)}saveAddOne(t,e){if(this.isOptimistic(e)){const s=this.guard.mustBeEntity(e),i=this.extractMergeStrategy(e);t=this.entityChangeTracker.trackAddOne(s,t,i),t=this.adapter.addOne(s,t)}return this.setLoadingTrue(t)}saveAddOneError(t,e){return this.setLoadingFalse(t)}saveAddOneSuccess(t,e){const s=this.guard.mustBeEntity(e),i=this.extractMergeStrategy(e);if(this.isOptimistic(e)){const e=this.toUpdate(s);t=this.entityChangeTracker.mergeSaveUpdates([e],t,i,!1)}else t=this.entityChangeTracker.mergeSaveAdds([s],t,i);return this.setLoadingFalse(t)}saveDeleteOne(t,e){const s=this.extractData(e),i="object"==typeof s?this.selectId(s):s,n=t.changeState[i];if(n&&(n.changeType===Be.Added?(t=this.adapter.removeOne(i,t),t=this.entityChangeTracker.commitOne(i,t),e.payload.skip=!0):t=this.entityChangeTracker.trackDeleteOne(i,t)),this.isOptimistic(e)){const s=this.extractMergeStrategy(e);t=this.entityChangeTracker.trackDeleteOne(i,t,s),t=this.adapter.removeOne(i,t)}return this.setLoadingTrue(t)}saveDeleteOneError(t,e){return this.setLoadingFalse(t)}saveDeleteOneSuccess(t,e){const s=this.extractData(e);if(this.isOptimistic(e)){const i=this.extractMergeStrategy(e);t=this.entityChangeTracker.mergeSaveDeletes([s],t,i)}else t=this.adapter.removeOne(s,t),t=this.entityChangeTracker.commitOne(s,t);return this.setLoadingFalse(t)}saveDeleteMany(t,e){const s=this.extractData(e).map(t=>"object"==typeof t?this.selectId(t):t);if(s.forEach(s=>{const i=t.changeState[s];i&&(i.changeType===Be.Added?(t=this.adapter.removeOne(s,t),t=this.entityChangeTracker.commitOne(s,t),e.payload.skip=!0):t=this.entityChangeTracker.trackDeleteOne(s,t))}),this.isOptimistic(e)){const i=this.extractMergeStrategy(e);t=this.entityChangeTracker.trackDeleteMany(s,t,i),t=this.adapter.removeMany(s,t)}return this.setLoadingTrue(t)}saveDeleteManyError(t,e){return this.setLoadingFalse(t)}saveDeleteManySuccess(t,e){const s=this.extractData(e);if(this.isOptimistic(e)){const i=this.extractMergeStrategy(e);t=this.entityChangeTracker.mergeSaveDeletes(s,t,i)}else t=this.adapter.removeMany(s,t),t=this.entityChangeTracker.commitMany(s,t);return this.setLoadingFalse(t)}saveUpdateOne(t,e){const s=this.guard.mustBeUpdate(e);if(this.isOptimistic(e)){const i=this.extractMergeStrategy(e);t=this.entityChangeTracker.trackUpdateOne(s,t,i),t=this.adapter.updateOne(s,t)}return this.setLoadingTrue(t)}saveUpdateOneError(t,e){return this.setLoadingFalse(t)}saveUpdateOneSuccess(t,e){const s=this.guard.mustBeUpdateResponse(e),i=this.isOptimistic(e),n=this.extractMergeStrategy(e);return t=this.entityChangeTracker.mergeSaveUpdates([s],t,n,i),this.setLoadingFalse(t)}saveUpdateMany(t,e){const s=this.guard.mustBeUpdates(e);if(this.isOptimistic(e)){const i=this.extractMergeStrategy(e);t=this.entityChangeTracker.trackUpdateMany(s,t,i),t=this.adapter.updateMany(s,t)}return this.setLoadingTrue(t)}saveUpdateManyError(t,e){return this.setLoadingFalse(t)}saveUpdateManySuccess(t,e){const s=this.guard.mustBeUpdateResponses(e),i=(this.isOptimistic(e),this.extractMergeStrategy(e));return t=this.entityChangeTracker.mergeSaveUpdates(s,t,i,!1),this.setLoadingFalse(t)}saveUpsertOne(t,e){if(this.isOptimistic(e)){const s=this.guard.mustBeEntity(e),i=this.extractMergeStrategy(e);t=this.entityChangeTracker.trackUpsertOne(s,t,i),t=this.adapter.upsertOne(s,t)}return this.setLoadingTrue(t)}saveUpsertOneError(t,e){return this.setLoadingFalse(t)}saveUpsertOneSuccess(t,e){const s=this.guard.mustBeEntity(e),i=this.extractMergeStrategy(e);return t=this.entityChangeTracker.mergeSaveUpserts([s],t,i),this.setLoadingFalse(t)}saveUpsertMany(t,e){if(this.isOptimistic(e)){const s=this.guard.mustBeEntities(e),i=this.extractMergeStrategy(e);t=this.entityChangeTracker.trackUpsertMany(s,t,i),t=this.adapter.upsertMany(s,t)}return this.setLoadingTrue(t)}saveUpsertManyError(t,e){return this.setLoadingFalse(t)}saveUpsertManySuccess(t,e){const s=this.guard.mustBeEntities(e),i=this.extractMergeStrategy(e);return t=this.entityChangeTracker.mergeSaveUpserts(s,t,i),this.setLoadingFalse(t)}addAll(t,e){const s=this.guard.mustBeEntities(e);return Object.assign(Object.assign({},this.adapter.addAll(s,t)),{loading:!1,loaded:!0,changeState:{}})}addMany(t,e){const s=this.guard.mustBeEntities(e),i=this.extractMergeStrategy(e);return t=this.entityChangeTracker.trackAddMany(s,t,i),this.adapter.addMany(s,t)}addOne(t,e){const s=this.guard.mustBeEntity(e),i=this.extractMergeStrategy(e);return t=this.entityChangeTracker.trackAddOne(s,t,i),this.adapter.addOne(s,t)}removeMany(t,e){const s=this.guard.mustBeKeys(e),i=this.extractMergeStrategy(e);return t=this.entityChangeTracker.trackDeleteMany(s,t,i),this.adapter.removeMany(s,t)}removeOne(t,e){const s=this.guard.mustBeKey(e),i=this.extractMergeStrategy(e);return t=this.entityChangeTracker.trackDeleteOne(s,t,i),this.adapter.removeOne(s,t)}removeAll(t,e){return Object.assign(Object.assign({},this.adapter.removeAll(t)),{loaded:!1,loading:!1,changeState:{}})}updateMany(t,e){const s=this.guard.mustBeUpdates(e),i=this.extractMergeStrategy(e);return t=this.entityChangeTracker.trackUpdateMany(s,t,i),this.adapter.updateMany(s,t)}updateOne(t,e){const s=this.guard.mustBeUpdate(e),i=this.extractMergeStrategy(e);return t=this.entityChangeTracker.trackUpdateOne(s,t,i),this.adapter.updateOne(s,t)}upsertMany(t,e){const s=this.guard.mustBeEntities(e),i=this.extractMergeStrategy(e);return t=this.entityChangeTracker.trackUpsertMany(s,t,i),this.adapter.upsertMany(s,t)}upsertOne(t,e){const s=this.guard.mustBeEntity(e),i=this.extractMergeStrategy(e);return t=this.entityChangeTracker.trackUpsertOne(s,t,i),this.adapter.upsertOne(s,t)}commitAll(t){return this.entityChangeTracker.commitAll(t)}commitMany(t,e){return this.entityChangeTracker.commitMany(this.extractData(e),t)}commitOne(t,e){return this.entityChangeTracker.commitOne(this.extractData(e),t)}undoAll(t){return this.entityChangeTracker.undoAll(t)}undoMany(t,e){return this.entityChangeTracker.undoMany(this.extractData(e),t)}undoOne(t,e){return this.entityChangeTracker.undoOne(this.extractData(e),t)}setChangeState(t,e){const s=this.extractData(e);return t.changeState===s?t:Object.assign(Object.assign({},t),{changeState:s})}setCollection(t,e){const s=this.extractData(e);return t===s?t:s}setFilter(t,e){const s=this.extractData(e);return t.filter===s?t:Object.assign(Object.assign({},t),{filter:s})}setLoaded(t,e){const s=!0===this.extractData(e)||!1;return t.loaded===s?t:Object.assign(Object.assign({},t),{loaded:s})}setLoading(t,e){return this.setLoadingFlag(t,this.extractData(e))}setLoadingFalse(t){return this.setLoadingFlag(t,!1)}setLoadingTrue(t){return this.setLoadingFlag(t,!0)}setLoadingFlag(t,e){return t.loading===(e=!0===e)?t:Object.assign(Object.assign({},t),{loading:e})}extractData(t){return t.payload&&t.payload.data}extractMergeStrategy(t){return this.isChangeTracking?t.payload&&t.payload.mergeStrategy:Y.IgnoreChanges}isOptimistic(t){return t.payload&&!0===t.payload.isOptimistic}}let Pe=(()=>{class t{constructor(t){this.entityDefinitionService=t}create(t){const e=this.entityDefinitionService.getDefinition(t);return new Ke(t,e).methods}}return t.\u0275fac=function(e){return new(e||t)(r.Rb(ae))},t.\u0275prov=r.Eb({token:t,factory:t.\u0275fac}),t})(),Ve=(()=>{class t{constructor(t){this.methodsFactory=t}create(t){const e=this.methodsFactory.create(t);return function(t,s){const i=e[s.payload.entityOp];return i?i(t,s):t}}}return t.\u0275fac=function(e){return new(e||t)(r.Rb(Pe))},t.\u0275prov=r.Eb({token:t,factory:t.\u0275fac}),t})(),Ge=(()=>{class t{constructor(t,e){this.entityCollectionReducerFactory=t,this.entityCollectionReducers={},this.entityCollectionMetaReducer=$.o.apply(null,e||[])}getOrCreateReducer(t){let e=this.entityCollectionReducers[t];return e||(e=this.entityCollectionReducerFactory.create(t),e=this.registerReducer(t,e),this.entityCollectionReducers[t]=e),e}registerReducer(t,e){return e=this.entityCollectionMetaReducer(e),this.entityCollectionReducers[t.trim()]=e}registerReducers(t){(t?Object.keys(t):[]).forEach(e=>this.registerReducer(e,t[e]))}}return t.\u0275fac=function(e){return new(e||t)(r.Rb(Ve),r.Rb(ve,8))},t.\u0275prov=r.Eb({token:t,factory:t.\u0275fac}),t})(),Qe=(()=>{class t{constructor(t,e,s){this.entityCollectionCreator=t,this.entityCollectionReducerRegistry=e,this.logger=s}create(){return(function(t={},e){switch(e.type){case tt:return this.clearCollectionsReducer(t,e);case et:return this.loadCollectionsReducer(t,e);case st:return this.mergeQuerySetReducer(t,e);case nt:return this.saveEntitiesReducer(t,e);case rt:return this.saveEntitiesCancelReducer(t,e);case at:return this.saveEntitiesErrorReducer(t,e);case ct:return this.saveEntitiesSuccessReducer(t,e);case it:return e.payload.cache}const s=e.payload;return s&&s.entityName&&s.entityOp&&!s.error?this.applyCollectionReducer(t,e):t}).bind(this)}clearCollectionsReducer(t,e){let{collections:s}=e.payload;return s||(s=Object.keys(t)),s.reduce((t,s)=>this.applyCollectionReducer(t,{type:`[${s}] ${e.type}`,payload:{entityName:s,entityOp:"@ngrx/data/remove-all"}}),t)}loadCollectionsReducer(t,e){const{collections:s}=e.payload;return Object.keys(s).reduce((t,i)=>this.applyCollectionReducer(t,{type:`[${i}] ${e.type}`,payload:{entityName:i,entityOp:"@ngrx/data/add-all",data:s[i]}}),t)}mergeQuerySetReducer(t,e){let{mergeStrategy:s,querySet:i}=e.payload;return s=null===s?Y.PreserveChanges:s,Object.keys(i).reduce((t,n)=>this.applyCollectionReducer(t,{type:`[${n}] ${e.type}`,payload:{entityName:n,entityOp:"@ngrx/data/query-many/success",data:i[n],mergeStrategy:s}}),t)}saveEntitiesReducer(t,e){const{changeSet:s,correlationId:i,isOptimistic:n,mergeStrategy:r,tag:a}=e.payload;try{s.changes.forEach(s=>{const o=s.entityName,h={entityName:o,entityOp:c(s),data:s.entities,correlationId:i,isOptimistic:n,mergeStrategy:r,tag:a},d={type:`[${o}] ${e.type}`,payload:h};if(t=this.applyCollectionReducer(t,d),d.payload.error)throw d.payload.error})}catch(o){e.payload.error=o}return t;function c(t){switch(t.op){case H:return Et;case J:return Mt;case z:return Dt;case Z:return Rt}}}saveEntitiesCancelReducer(t,e){return this.clearLoadingFlags(t,e.payload.entityNames||[])}saveEntitiesErrorReducer(t,e){const s=e.payload.originalAction.payload.changeSet.changes.map(t=>t.entityName);return this.clearLoadingFlags(t,s)}saveEntitiesSuccessReducer(t,e){const{changeSet:s,correlationId:i,isOptimistic:n,mergeStrategy:r,tag:a}=e.payload;return s.changes.forEach(s=>{const o=s.entityName,h={entityName:o,entityOp:c(s),data:s.entities,correlationId:i,isOptimistic:n,mergeStrategy:r,tag:a};t=this.applyCollectionReducer(t,{type:`[${o}] ${e.type}`,payload:h})}),t;function c(t){switch(t.op){case H:return Ct;case J:return At;case z:return kt;case Z:return Nt}}}applyCollectionReducer(t={},e){const s=e.payload.entityName,i=t[s],n=this.entityCollectionReducerRegistry.getOrCreateReducer(s);let r;try{r=n(i||this.entityCollectionCreator.create(s),e)}catch(a){this.logger.error(a),e.payload.error=a}return e.payload.error||i===r?t:Object.assign(Object.assign({},t),{[s]:r})}clearLoadingFlags(t,e){let s=!1;return e.forEach(e=>{const i=t[e];i.loading&&(s||(t=Object.assign({},t),s=!0),t[e]=Object.assign(Object.assign({},i),{loading:!1}))}),t}}return t.\u0275fac=function(e){return new(e||t)(r.Rb(Re),r.Rb(Ge),r.Rb(Xt))},t.\u0275prov=r.Eb({token:t,factory:t.\u0275fac}),t})(),_e=(()=>{class t{error(t,e){t&&(e?console.error(t,e):console.error(t))}log(t,e){t&&(e?console.log(t,e):console.log(t))}warn(t,e){t&&(e?console.warn(t,e):console.warn(t))}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=r.Eb({token:t,factory:t.\u0275fac}),t})();const We=["equipment","information","money","series"];let He=(()=>{class t{constructor(t){this.pluralNames={},t&&t.forEach(t=>this.registerPluralNames(t))}pluralize(t){return this.pluralNames[t]||(We.indexOf(t.toLowerCase())>=0?t:/[aeiou]y$/.test(t)?t+"s":t.endsWith("y")?t.substr(0,t.length-1)+"ies":/[s|ss|sh|ch|x|z]$/.test(t)?t+"es":t+"s")}registerPluralNames(t){this.pluralNames=Object.assign(Object.assign({},this.pluralNames),t||{})}}return t.\u0275fac=function(e){return new(e||t)(r.Rb(Yt,8))},t.\u0275prov=r.Eb({token:t,factory:t.\u0275fac}),t})(),Je=(()=>{class t{constructor(t,e,s,i,n,a){this.reducerManager=t,this.injector=s,this.entityCacheName=i,this.initialState=n,this.metaReducers=a;const c=i||me;n="function"==typeof n?n():n;const o=(a||[]).map(t=>t instanceof r.q?s.get(t):t);this.entityCacheFeature={key:c,reducers:e.create(),reducerFactory:$.n,initialState:n||{},metaReducers:o},t.addFeature(this.entityCacheFeature)}static forRoot(e){return{ngModule:t,providers:[{provide:Oe,useValue:e.entityCacheMetaReducers?e.entityCacheMetaReducers:[]},{provide:ve,useValue:e.entityCollectionMetaReducers?e.entityCollectionMetaReducers:[]},{provide:Yt,multi:!0,useValue:e.pluralNames?e.pluralNames:{}}]}}ngOnDestroy(){this.reducerManager.removeFeature(this.entityCacheFeature)}}return t.\u0275mod=r.Gb({type:t}),t.\u0275inj=r.Fb({factory:function(e){return new(e||t)(r.Rb($.d),r.Rb(Qe),r.Rb(r.r),r.Rb(fe,8),r.Rb(Se,8),r.Rb(Oe,8))},providers:[ue,ye,K,ge,Qe,Ce,Re,Ve,Pe,Ge,Ue,$e,ae,Me,Ne,Ie,Te,{provide:fe,useValue:"entityCache"},{provide:Le,useClass:Fe},{provide:Xt,useClass:_e}],imports:[[$.k]]}),t})(),ze=(()=>{class t{constructor(t,e,s){this.effectSources=t,this.addEffects(e),this.addEffects(s)}static forRoot(e){return{ngModule:t,providers:[{provide:re,multi:!0,useValue:e.entityMetadata?e.entityMetadata:[]},{provide:Oe,useValue:e.entityCacheMetaReducers?e.entityCacheMetaReducers:[]},{provide:ve,useValue:e.entityCollectionMetaReducers?e.entityCollectionMetaReducers:[]},{provide:Yt,multi:!0,useValue:e.pluralNames?e.pluralNames:{}}]}}addEffects(t){this.effectSources.addEffects(t)}}return t.\u0275mod=r.Gb({type:t}),t.\u0275inj=r.Fb({factory:function(e){return new(e||t)(r.Rb(q.b),r.Rb(we),r.Rb(ke))},providers:[ne,oe,he,we,ke,{provide:ee,useClass:se},{provide:de,useClass:le},{provide:te,useClass:He}],imports:[[Je,q.c]]}),t})(),Ze=(()=>{class t extends xe{constructor(t){super("Comment",t)}}return t.\u0275fac=function(e){return new(e||t)(r.Rb(Ue))},t.\u0275prov=r.Eb({token:t,factory:t.\u0275fac}),t})();var Xe=s("3Pt+");let Ye=(()=>{class t{constructor(t,e){this.commentService=t,this.router=e}ngOnInit(){}addComment(t){this.sub=this.commentService.add(t).subscribe(()=>{this.router.navigateByUrl("/comments")})}ngOnDestroy(){this.sub.unsubscribe()}}return t.\u0275fac=function(e){return new(e||t)(r.Ib(Ze),r.Ib(n.f))},t.\u0275cmp=r.Cb({type:t,selectors:[["app-add-comment"]],decls:19,vars:0,consts:[[1,"container-fluid"],[3,"ngSubmit"],["form","ngForm"],[1,"mb-3"],["for","name",1,"form-label"],["type","text","id","name","ngModel","","name","name",1,"form-control"],["for","email",1,"form-label"],["type","email","id","email","ngModel","","name","email",1,"form-control"],["for","body",1,"form-label"],["rows","3","id","body","ngModel","","name","body",1,"form-control"],["type","submit",1,"btn","btn-primary"]],template:function(t,e){if(1&t){const t=r.Ob();r.Nb(0,"div",0),r.Nb(1,"h1"),r.ic(2,"Add New Comment"),r.Mb(),r.Nb(3,"form",1,2),r.Ub("ngSubmit",function(){r.ec(t);const s=r.dc(4);return e.addComment(s.value)}),r.Nb(5,"div",3),r.Nb(6,"label",4),r.ic(7,"Name"),r.Mb(),r.Jb(8,"input",5),r.Mb(),r.Nb(9,"div",3),r.Nb(10,"label",6),r.ic(11,"Email"),r.Mb(),r.Jb(12,"input",7),r.Mb(),r.Nb(13,"div",3),r.Nb(14,"label",8),r.ic(15,"Description"),r.Mb(),r.Jb(16,"textarea",9),r.Mb(),r.Nb(17,"button",10),r.ic(18,"Add Post"),r.Mb(),r.Mb(),r.Mb()}},directives:[Xe.g,Xe.d,Xe.e,Xe.a,Xe.c,Xe.f],styles:[""],changeDetection:0}),t})();const ts=function(t){return[t,"edit"]};function es(t,e){if(1&t){const t=r.Ob();r.Nb(0,"tr"),r.Nb(1,"td"),r.ic(2),r.Mb(),r.Nb(3,"td"),r.ic(4),r.Mb(),r.Nb(5,"td"),r.ic(6),r.Mb(),r.Nb(7,"td"),r.ic(8),r.Mb(),r.Nb(9,"td"),r.Nb(10,"a",8),r.Jb(11,"i",9),r.Mb(),r.Nb(12,"button",10),r.Ub("click",function(){r.ec(t);const s=e.$implicit;return r.Wb(2).removeComment(s)}),r.Jb(13,"i",11),r.Mb(),r.Mb(),r.Mb()}if(2&t){const t=e.$implicit;r.yb(2),r.jc(t.id),r.yb(2),r.jc(t.name),r.yb(2),r.jc(t.email),r.yb(2),r.jc(t.body),r.yb(2),r.Zb("state",t)("routerLink",r.bc(6,ts,t.id))}}const ss=function(){return["new"]};function is(t,e){if(1&t&&(r.Nb(0,"div",1),r.Nb(1,"div",2),r.Nb(2,"h1"),r.ic(3,"Comments"),r.Mb(),r.Nb(4,"a",3),r.Jb(5,"i",4),r.Mb(),r.Mb(),r.Nb(6,"table",5),r.Nb(7,"thead",6),r.Nb(8,"tr"),r.Nb(9,"th"),r.ic(10,"#ID"),r.Mb(),r.Nb(11,"th"),r.ic(12,"Title"),r.Mb(),r.Nb(13,"th"),r.ic(14,"Date"),r.Mb(),r.Nb(15,"th"),r.ic(16,"Description"),r.Mb(),r.Nb(17,"th"),r.ic(18,"Action"),r.Mb(),r.Mb(),r.Mb(),r.Nb(19,"tbody"),r.hc(20,es,14,8,"tr",7),r.Mb(),r.Mb(),r.Mb()),2&t){const t=e.ngIf;r.yb(4),r.Zb("routerLink",r.ac(2,ss)),r.yb(16),r.Zb("ngForOf",t)}}let ns=(()=>{class t{constructor(t){this.commentService=t}ngOnInit(){this.comments$=this.commentService.entities$}removeComment(t){this.commentService.delete(t)}}return t.\u0275fac=function(e){return new(e||t)(r.Ib(Ze))},t.\u0275cmp=r.Cb({type:t,selectors:[["app-comments"]],decls:2,vars:3,consts:[["class","container-fluid",4,"ngIf"],[1,"container-fluid"],[1,"d-flex","justify-content-between"],["title","Add Comment",1,"btn","btn-primary","d-flex","align-self-center",3,"routerLink"],[1,"ti-plus"],[1,"table"],[1,"thead-light"],[4,"ngFor","ngForOf"],["title","Edit comment",1,"btn","btn-primary","mr-2",3,"state","routerLink"],[1,"ti-pencil"],["title","Remove comment",1,"btn","btn-danger",3,"click"],[1,"ti-trash"]],template:function(t,e){1&t&&(r.hc(0,is,21,3,"div",0),r.Xb(1,"async")),2&t&&r.Zb("ngIf",r.Yb(1,1,e.comments$))},directives:[i.k,n.h,i.j],pipes:[i.b],styles:["thead.thead-light[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]:last-child{width:120px}"],changeDetection:0}),t})();function rs(t,e){if(1&t){const t=r.Ob();r.Nb(0,"form",2,3),r.Ub("ngSubmit",function(){r.ec(t);const e=r.dc(1);return r.Wb().updateComment(e.value)}),r.Nb(2,"div",4),r.Nb(3,"label",5),r.ic(4,"Name"),r.Mb(),r.Jb(5,"input",6),r.Mb(),r.Nb(6,"div",4),r.Nb(7,"label",7),r.ic(8,"Email"),r.Mb(),r.Jb(9,"input",8),r.Mb(),r.Nb(10,"div",4),r.Nb(11,"label",9),r.ic(12,"Description"),r.Mb(),r.Jb(13,"textarea",10),r.Mb(),r.Nb(14,"button",11),r.ic(15,"Update Comment"),r.Mb(),r.Mb()}if(2&t){const t=r.Wb();r.yb(5),r.Zb("ngModel",t.comment.name),r.yb(4),r.Zb("ngModel",t.comment.email),r.yb(4),r.Zb("ngModel",t.comment.body)}}let as=(()=>{class t{constructor(t,e,s){this.router=t,this.location=e,this.commentService=s}ngOnInit(){this.comment=this.location.getState()}updateComment(t){const e=Object.assign(Object.assign({},this.comment),t);this.commentService.update(e),this.router.navigateByUrl("/comments")}}return t.\u0275fac=function(e){return new(e||t)(r.Ib(n.f),r.Ib(i.h),r.Ib(Ze))},t.\u0275cmp=r.Cb({type:t,selectors:[["app-edit-comment"]],decls:4,vars:1,consts:[[1,"container-fluid"],[3,"ngSubmit",4,"ngIf"],[3,"ngSubmit"],["form","ngForm"],[1,"mb-3"],["for","name",1,"form-label"],["type","text","id","name","name","name",1,"form-control",3,"ngModel"],["for","email",1,"form-label"],["type","email","id","email","name","email",1,"form-control",3,"ngModel"],["for","body",1,"form-label"],["rows","3","id","body","name","body",1,"form-control",3,"ngModel"],["type","submit",1,"btn","btn-primary"]],template:function(t,e){1&t&&(r.Nb(0,"div",0),r.Nb(1,"h1"),r.ic(2,"Edit Comment"),r.Mb(),r.hc(3,rs,16,3,"form",1),r.Mb()),2&t&&(r.yb(3),r.Zb("ngIf",e.comment))},directives:[i.k,Xe.g,Xe.d,Xe.e,Xe.a,Xe.c,Xe.f],styles:[""],changeDetection:0}),t})();var cs=s("vkgz"),os=s("SxV6");let hs=(()=>{class t{constructor(t){this.commentService=t}resolve(t,e){return this.commentService.loaded$.pipe(Object(cs.a)(t=>{t||this.commentService.getAll()}),Object(a.a)(t=>!!t),Object(os.a)())}}return t.\u0275fac=function(e){return new(e||t)(r.Rb(Ze))},t.\u0275prov=r.Eb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();const ds=[{path:"",component:ns,resolve:{comments:hs}},{path:"new",component:Ye},{path:":commentId/edit",component:as}];let ls=(()=>{class t{}return t.\u0275mod=r.Gb({type:t}),t.\u0275inj=r.Fb({factory:function(e){return new(e||t)},imports:[[n.i.forChild(ds)],n.i]}),t})(),us=(()=>{class t extends ie{constructor(t,e){super("Comment",t,e),this.API_URL="https://jsonplaceholder.typicode.com/comments"}getAll(){return this.http.get(this.API_URL)}add(t){return this.http.post(this.API_URL,t)}update(t){return this.http.put(`${this.API_URL}/${t.id}`,t)}delete(t){return this.http.delete(`${this.API_URL}/${t}`)}}return t.\u0275fac=function(e){return new(e||t)(r.Rb(j.a),r.Rb(ee))},t.\u0275prov=r.Eb({token:t,factory:t.\u0275fac}),t})();const ys={Comment:{sortComparer:function(t,e){const s=t.name-e.name;return s>0?1:s<0?-1:0},entityDispatcherOptions:{optimisticUpdate:!0}}};let ps=(()=>{class t{constructor(t,e,s){this.eds=t,this.entityDataService=e,this.commentDataService=s,this.eds.registerMetadataMap(ys),this.entityDataService.registerService("Comment",this.commentDataService)}}return t.\u0275mod=r.Gb({type:t}),t.\u0275inj=r.Fb({factory:function(e){return new(e||t)(r.Rb(ae),r.Rb(he),r.Rb(us))},providers:[hs,Ze,us],imports:[[i.c,ls,Xe.b,j.b,ze.forRoot({})]]}),t})()}}]);